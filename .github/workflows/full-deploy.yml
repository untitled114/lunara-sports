name: Frontend Deployment (LEGACY - Backend moved to Container Apps)

on:
  push:
    branches: [ master, main ]
    paths:
      - 'frontend/**'
      - '.github/workflows/full-deploy.yml'
  workflow_dispatch:
    inputs:
      deploy_frontend:
        description: 'Deploy frontend'
        required: true
        default: 'true'
        type: boolean

env:
  REGISTRY_NAME: lunaraappregistry
  RESOURCE_GROUP: lunara-app-rg
  CONTAINER_NAME: lunara-app-backend
  IMAGE_NAME: lunara-backend

jobs:
  changes:
    runs-on: ubuntu-latest
    outputs:
      backend: ${{ steps.filter.outputs.backend }}
      frontend: ${{ steps.filter.outputs.frontend }}
    steps:
      - uses: actions/checkout@v3
      - uses: dorny/paths-filter@v2
        id: filter
        with:
          filters: |
            backend:
              - 'backend/**'
            frontend:
              - 'frontend/**'

  deploy-frontend:
    needs: changes
    if: ${{ needs.changes.outputs.frontend == 'true' || github.event.inputs.deploy_frontend == 'true' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Backend is now deployed separately via Container Apps workflow

      - name: Deploy to Static Web Apps
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.AZURE_STATIC_WEB_APPS_API_TOKEN }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          action: "upload"
          app_location: "frontend"
          api_location: ""
          output_location: "dist"
          production_branch: "master"

  notify:
    needs: deploy-frontend
    if: ${{ always() }}
    runs-on: ubuntu-latest
    steps:
      - name: Deployment Summary
        run: |
          echo "ðŸš€ Frontend Deployment Complete!"
          echo "Frontend: https://lunara-app.com"
          echo "Frontend Alt: https://orange-tree-0e991820f.1.azurestaticapps.net"
          echo "Backend: https://lunara-backend.gentlemoss-6a60b505.eastus.azurecontainerapps.io"
